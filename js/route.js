// var data = [{
//     "coordinates": [
//         [-74.01311419351043, 40.717234351040446],
//         [-74.0119836783191, 40.71678993324426]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.0119836783191, 40.71678993324426],
//         [-74.01102931559512, 40.716360530682465]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.01102931559512, 40.716360530682465],
//         [-74.0101806749953, 40.71603996663461]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.0101806749953, 40.71603996663461],
//         [-74.00926039682776, 40.71560475021769]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.00926039682776, 40.71560475021769],
//         [-74.00856921848333, 40.71645833085606]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.00856921848333, 40.71645833085606],
//         [-74.00795136190783, 40.717199614071404]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.00795136190783, 40.717199614071404],
//         [-74.00731689306315, 40.71805991295619]
//     ],
//     'symbol': {
//         'lineColor': '#ccff33'
//     }
// }, {
//     "coordinates": [
//         [-74.00731689306315, 40.71805991295619],
//         [-74.00661609571853, 40.71893991720597]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.00661609571853, 40.71893991720597],
//         [-74.00601003351494, 40.719753702775364]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.00601003351494, 40.719753702775364],
//         [-74.0056579849018, 40.72013579143456]
//     ],
//     'symbol': {
//         'lineColor': '#ccff33'
//     }
// }, {
//     "coordinates": [
//         [-74.0056579849018, 40.72013579143456],
//         [-74.00521809431285, 40.72004999645665]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.00521809431285, 40.72004999645665],
//         [-74.0052126826792, 40.719219380104875]
//     ],
//     'symbol': {
//         'lineColor': '#ccff33'
//     }
// }, {
//     "coordinates": [
//         [-74.0052126826792, 40.719219380104875],
//         [-74.00529150674197, 40.71835955780941]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.00529150674197, 40.71835955780941],
//         [-74.00601248378882, 40.71758692979259]
//     ],
//     'symbol': {
//         'lineColor': '#ccff33'
//     }
// }, {
//     "coordinates": [
//         [-74.00601248378882, 40.71758692979259],
//         [-74.00672896703918, 40.71668953570631]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.00672896703918, 40.71668953570631],
//         [-74.0074219969112, 40.715820421776385]
//     ],
//     'symbol': {
//         'lineColor': '#ccff33'
//     }
// }, {
//     "coordinates": [
//         [-74.0074219969112, 40.715820421776385],
//         [-74.00795726919125, 40.71512579229372]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.00795726919125, 40.71512579229372],
//         [-74.00844170980133, 40.71446954277636]
//     ],
//     'symbol': {
//         'lineColor': '#ccff33'
//     }
// }, {
//     "coordinates": [
//         [-74.00844170980133, 40.71446954277636],
//         [-74.00890048633983, 40.713874881263536]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.00890048633983, 40.713874881263536],
//         [-74.00840512105071, 40.71366616175246]
//     ],
//     'symbol': {
//         'lineColor': '#cc0000'
//     }
// }, {
//     "coordinates": [
//         [-74.00840512105071, 40.71366616175246],
//         [-74.00794134948285, 40.71338541458974]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.00794134948285, 40.71338541458974],
//         [-74.00744657191422, 40.71316091783066]
//     ],
//     'symbol': {
//         'lineColor': '#cc0000'
//     }
// }, {
//     "coordinates": [
//         [-74.00744657191422, 40.71316091783066],
//         [-74.00723512343365, 40.71301377989724]
//     ],
//     'symbol': {
//         'lineColor': '#cc0000'
//     }
// }, {
//     "coordinates": [
//         [-74.00723512343365, 40.71301377989724],
//         [-74.0077549183411, 40.712444576907245]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.0077549183411, 40.712444576907245],
//         [-74.00803685432345, 40.71203694287894]
//     ],
//     'symbol': {
//         'lineColor': '#cc0000'
//     }
// }, {
//     "coordinates": [
//         [-74.00803685432345, 40.71203694287894],
//         [-74.00759930663895, 40.711644779769216]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.00759930663895, 40.711644779769216],
//         [-74.00666120937404, 40.71190454690256]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.00666120937404, 40.71190454690256],
//         [-74.00567649072036, 40.71219357909402]
//     ],
//     'symbol': {
//         'lineColor': '#99ff00'
//     }
// }, {
//     "coordinates": [
//         [-74.00567649072036, 40.71219357909402],
//         [-74.00483031199155, 40.71253735573512]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.00483031199155, 40.71253735573512],
//         [-74.00402308161443, 40.71323523959845]
//     ],
//     'symbol': {
//         'lineColor': '#99ff00'
//     }
// }, {
//     "coordinates": [
//         [-74.00402308161443, 40.71323523959845],
//         [-74.00326273165837, 40.71444183172102]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.00326273165837, 40.71444183172102],
//         [-74.00303281363824, 40.71563532718923]
//     ],
//     'symbol': {
//         'lineColor': '#99ff00'
//     }
// }, {
//     "coordinates": [
//         [-74.00303281363824, 40.71563532718923],
//         [-74.0018507123853, 40.716993136119044]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.0018507123853, 40.716993136119044],
//         [-74.00045352658935, 40.71851191765447]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }, {
//     "coordinates": [
//         [-74.00045352658935, 40.71851191765447],
//         [-73.99908411732548, 40.7200072906048]
//     ],
//     'symbol': {
//         'lineColor': '#99ff00'
//     }
// }, {
//     "coordinates": [
//         [-73.99908411732548, 40.7200072906048],
//         [-73.99776718836381, 40.72162936808857]
//     ],
//     'symbol': {
//         'lineColor': '#ff3333'
//     }
// }];
// var odlayer = new maptalks.ODLineLayer('od', data, {
//         'animation': false,
//         'curveness': 0,
//         'globalCompositeOperation': 'lighter',
//         'symbol': {
//             'lineWidth': 2,
//             'lineColor': 'rgba(255,153,51, 0.2)',
//         },
//     })
//     .addTo(map);

// var clayer = new maptalks.ODLineLayer('c', data, {
//     'animationDuration': 1500,
//     'animation': true,
//     'fps': 5,
//     'curveness': 0,
//     'random': true,
//     'trail': 80,
// }).addTo(map);

function getColor() {
    var i = Math.random() * 3;
    if (i < 1) {
        return '#ff9900';
    } else if (i < 2) {
        return '#cc0000';
    } else {
        return '#ffcc00';
    }
}

const xhttp2 = new XMLHttpRequest();
xhttp2.onreadystatechange = function () {
    if (this.readyState == 4 && this.status == 200) {
        const features = JSON.parse(this.responseText);
        var warr = [];
        features.features.forEach(function (g) {
            var arr = [];
            for (var i = 0; i < g.geometry.coordinates.length - 1; i++) {
                arr.push({
                    "coordinates": [
                        g.geometry.coordinates[i], g.geometry.coordinates[i + 1]
                    ],
                    'symbol': {
                        'lineColor': getColor()
                    }
                });
            }
            warr.push(arr);
        });
        var odlayer = new maptalks.ODLineLayer('od', warr, {
            'animation': false,
            // 'curveness': 0,
            'globalCompositeOperation': 'lighter',
            'symbol': {
                'lineWidth': 2,
                'lineColor': 'rgba(255,153,51, 0.2)',
            },
        }).addTo(map);

        // var clayer = new maptalks.ODLineLayer('c', warr, {
        //     'animationDuration': 200,
        //     'animation': true,
        //     // 'curveness': 0,
        //     'random': true,
        //     'trail': 25,
        // }).addTo(map);
    }

};


const xhttp3 = new XMLHttpRequest();
xhttp3.onreadystatechange = function () {
    if (this.readyState == 4 && this.status == 200) {
        const features = JSON.parse(this.responseText);
        var warr = [];
        features.forEach(function (g) {
            var arr = [];
            for (var i = 0; i < g.segments.length - 1; i++) {
                arr.push({
                    "coordinates": [
                        g.segments[i], g.segments[i + 1]
                    ],
                    'symbol': {
                        'lineColor': getColor()
                    }
                });
            }
            warr.push(arr);
        });

        var clayer = new maptalks.ODLineLayer('c', warr, {
            'animationDuration': 200,
            'animation': true,
            // 'curveness': 0,
            'random': true,
            'trail': 25,
        }).addTo(map);
    }

};

xhttp2.open("GET", "./data/deck_roads.json", true);
xhttp2.send();
xhttp3.open("GET", "./data/deck_trips.json", true);
xhttp3.send();